{"data":{"site":{"siteMetadata":{"title":"Kaier33","author":"KaierChou"}},"markdownRemark":{"id":"d4f4f3cf-53c6-5a92-8f6c-7dbcb36b251b","html":"<h2 id=\"javascript-is-a-single-thread-language\"><a href=\"#javascript-is-a-single-thread-language\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript is a single thread language</h2>\n<p>ä¼—æ‰€å‘¨çŸ¥,  JSæ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€,  è¿™å’Œå®ƒçš„ç”¨é€”æœ‰å…³ï¼Œä½œä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥å¤„ç†é¡µé¢ä¸­ç”¨æˆ·çš„äº¤äº’ï¼Œä»¥åŠæ“ä½œDOMæ ‘ã€CSSæ ·å¼æ ‘æ¥ç»™ç”¨æˆ·å‘ˆç°ä¸€ä»½åŠ¨æ€è€Œä¸°å¯Œçš„äº¤äº’ä½“éªŒå’ŒæœåŠ¡å™¨é€»è¾‘çš„äº¤äº’å¤„ç†ã€‚</p>\n<p>å¦‚æœJavaScriptæ˜¯å¤šçº¿ç¨‹çš„æ–¹å¼æ¥æ“ä½œè¿™äº›UI DOMï¼Œåˆ™å¯èƒ½å‡ºç°UIæ“ä½œçš„å†²çªã€‚</p>\n<p>æµè§ˆå™¨ä¸­çš„GUIçº¿ç¨‹å’ŒJSå¼•æ“æ˜¯äº’æ–¥çš„,  å½“JSå¼•æ“æ‰§è¡Œæ—¶GUIçº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ŒGUIæ›´æ–°åˆ™ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰åˆ°JSå¼•æ“çº¿ç¨‹ç©ºé—²æ—¶ç«‹å³è¢«æ‰§è¡Œã€‚</p>\n<p>å¦‚æœæœ‰ä¸€ä¸ªè¿›ç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆå®ƒå°†é˜»å¡å…¶ä»–è¿›ç¨‹è¿è¡Œã€‚</p>\n<p>å› æ­¤ï¼Œåœ¨æµè§ˆå™¨ä¸­å®šä¹‰äº†ä¸€ä¸ªç­‰å¾…è¿›ç¨‹å“åº”çš„è¶…æ—¶ä»»åŠ¡ã€‚å½“è¿›ç¨‹åœ¨è¶…æ—¶ä¸­æ²¡æœ‰å“åº”æ—¶ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªå¼¹å‡ºçª—å£ï¼Œè¯¢é—®æ˜¯å¦ç»ˆæ­¢è¿™ä¸ªé¡µé¢ã€‚</p>\n<div align=\"center\">\n  <img src=\"https://i.ibb.co/QNY2TGx/killPage.jpg\">\n</div>\n<blockquote>\n<p>å…³äº Web Worker, è™½ç„¶è¿è¡Œ JavaScript è„šæœ¬åˆ›å»ºå¤šä¸ªçº¿ç¨‹, ä½†æ˜¯å­çº¿ç¨‹å®Œå…¨å—ä¸»çº¿ç¨‹æ§åˆ¶, ä¸”ä¸å¾—æ“ä½œDOM, æ‰€ä»¥è¿™ä¸ªæ–°æ ‡å‡†æ²¡æœ‰æ”¹å˜JavaScriptå•çº¿ç¨‹çš„æœ¬è´¨ã€‚</p>\n</blockquote>\n<h2 id=\"javascript-runtime-engine\"><a href=\"#javascript-runtime-engine\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript runtime engine</h2>\n<div align=\"center\">\n  <img src=\"https://i.ibb.co/s39YRy8/js.png\">\n</div>\n<blockquote>\n<p>JSå†…å­˜ç©ºé—´  </p>\n</blockquote>\n<p><strong>Memory Heap</strong>:  å † æ˜¯æˆ‘ä»¬å®šä¹‰å˜é‡æ—¶å­˜å‚¨å¯¹è±¡çš„åœ°æ–¹.    </p>\n<p><strong>Call Stack</strong>: æ‰§è¡Œæ ˆï¼Œä¹Ÿå°±æ˜¯åœ¨å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­æ‰€è¯´çš„â€œè°ƒç”¨æ ˆâ€ï¼Œæ˜¯ä¸€ç§æ‹¥æœ‰ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰æ•°æ®ç»“æ„çš„æ ˆï¼Œè¢«ç”¨æ¥å­˜å‚¨ä»£ç è¿è¡Œæ—¶åˆ›å»ºçš„æ‰€æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚<br>\nå½“ JavaScript å¼•æ“ç¬¬ä¸€æ¬¡é‡åˆ°ä½ çš„è„šæœ¬æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶ä¸”å‹å…¥å½“å‰æ‰§è¡Œæ ˆã€‚æ¯å½“å¼•æ“é‡åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå®ƒä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶å‹å…¥æ ˆçš„é¡¶éƒ¨ã€‚<br>\nå¼•æ“ä¼šæ‰§è¡Œé‚£äº›æ‰§è¡Œä¸Šä¸‹æ–‡ä½äºæ ˆé¡¶çš„å‡½æ•°ã€‚å½“è¯¥å‡½æ•°æ‰§è¡Œç»“æŸæ—¶ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆä¸­å¼¹å‡ºï¼Œæ§åˆ¶æµç¨‹åˆ°è¾¾å½“å‰æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚  </p>\n<p>ä¸¤è€…åŒºåˆ«:  </p>\n<table>\n<thead>\n<tr>\n<th align=\"left\"><code class=\"language-text\">æ ˆå†…å­˜</code></th>\n<th align=\"left\"><code class=\"language-text\">å †å†…å­˜</code></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"left\">å­˜å‚¨åŸºç¡€æ•°æ®ç±»å‹</td>\n<td align=\"left\">å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹</td>\n</tr>\n<tr>\n<td align=\"left\">æŒ‰å€¼è®¿é—®</td>\n<td align=\"left\">æŒ‰å¼•ç”¨è®¿é—®</td>\n</tr>\n<tr>\n<td align=\"left\">å­˜å‚¨çš„å€¼å¤§å°å›ºå®š</td>\n<td align=\"left\">å­˜å‚¨çš„å€¼å¤§å°ä¸å®šï¼Œå¯åŠ¨æ€è°ƒæ•´</td>\n</tr>\n<tr>\n<td align=\"left\">ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´</td>\n<td align=\"left\">ç”±ç¨‹åºå‘˜é€šè¿‡ä»£ç è¿›è¡Œåˆ†é…</td>\n</tr>\n<tr>\n<td align=\"left\">ä¸»è¦ç”¨æ¥æ‰§è¡Œç¨‹åº</td>\n<td align=\"left\">ä¸»è¦ç”¨æ¥å­˜æ”¾å¯¹è±¡</td>\n</tr>\n<tr>\n<td align=\"left\">ç©ºé—´å°ï¼Œè¿è¡Œæ•ˆç‡é«˜</td>\n<td align=\"left\">ç©ºé—´å¤§ï¼Œä½†æ˜¯è¿è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</td>\n</tr>\n<tr>\n<td align=\"left\">å…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡º</td>\n<td align=\"left\">æ— åºå­˜å‚¨ï¼Œå¯æ ¹æ®å¼•ç”¨ç›´æ¥è·å–</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>Web APIs </p>\n</blockquote>\n<p>æµè§ˆå™¨æä¾›äº†ä¸€ç³»åˆ—çš„APIï¼Œä¾›å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒä»¬è¿›è¡Œå¤æ‚çš„æµç¨‹ï¼Œä¾‹å¦‚è·å–è®¿é—®è€…çš„ä½ç½®, å‘èµ·è¯·æ±‚ç­‰.<br>\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/API\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">æŸ¥çœ‹Web APIs list</a>  </p>\n<blockquote>\n<p>Callback Queue </p>\n</blockquote>\n<p>å½“è¿›ç¨‹å®Œæˆå…¶å·¥ä½œï¼ˆä¾‹å¦‚XHRè°ƒç”¨ï¼‰æ—¶ï¼Œå®ƒä¼šè¢«æ”¾å…¥å›è°ƒé˜Ÿåˆ—ä¸­ã€‚<br>\nå †æ ˆä¸ºç©ºåï¼Œäº‹ä»¶å¾ªç¯è¿›ç¨‹å°†è§¦å‘å›è°ƒé˜Ÿåˆ—ï¼Œè¿™æ„å‘³ç€è¯¥è¿›ç¨‹åœ¨è¯¥é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç›´åˆ°å †æ ˆä¸ºç©ºã€‚<br>\nä¸€æ—¦æˆ‘ä»¬çš„å †æ ˆæ²¡æœ‰å‡½æ•°è°ƒç”¨ï¼Œå°±ä¼šä»å›è°ƒé˜Ÿåˆ—ä¸­å¼¹å‡ºä¸€ä¸ªè¿›ç¨‹å¹¶å°†å…¶æ¨å…¥å †æ ˆã€‚  </p>\n<blockquote>\n<p>Event Loop</p>\n</blockquote>\n<p>JSçš„å•çº¿ç¨‹ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„ä»»åŠ¡éƒ½éœ€è¦æŒ‰ç…§ä¸€å®šçš„è§„åˆ™é¡ºåºæ’é˜Ÿæ‰§è¡Œï¼Œè¿™ä¸ªè§„åˆ™å°±æ˜¯æˆ‘ä»¬è¦è¯´æ˜çš„Event Loopäº‹ä»¶ç¯ã€‚Event Loopåœ¨ä¸åŒçš„è¿è¡Œç¯å¢ƒä¸‹æœ‰ç€ä¸åŒçš„æ–¹å¼ã€‚(æœ¬æ–‡æˆ‘ä»¬åªè¯´å¤„äºæµè§ˆå™¨ä¸‹çš„æƒ…å†µ)  </p>\n<p>æ€»ç»“ä¸€ä¸‹:  </p>\n<ul>\n<li>\n<p>æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆ</p>\n</li>\n<li>\n<p>ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚åªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœï¼Œå°±åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚</p>\n</li>\n<li>\n<p>ä¸€æ—¦æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—,å°†é˜Ÿåˆ—ä¸­çš„äº‹ä»¶æ”¾åˆ°æ‰§è¡Œæ ˆä¸­ä¾æ¬¡æ‰§è¡Œ</p>\n</li>\n<li>\n<p>ä¸»çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è¯»å–äº‹ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯ä¸æ–­çš„.  </p>\n</li>\n</ul>\n<p>ä¸¾ä¸ªğŸŒ°  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// è¾“å‡º 1, 3, 2</span></code></pre></div>\n<h2 id=\"tasks-and-microtasks\"><a href=\"#tasks-and-microtasks\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tasks and Microtasks.</h2>\n<p>JavaScript ä¸­çš„å¼‚æ­¥é˜Ÿåˆ—,  å¯åˆ†ä¸º task å’Œ micro - task.<br>\nè€Œå…³äº task, ç½‘ç»œä¸Šæµè¡Œä¸¤ç§å«æ³•, ä¸€ç§ä¸º task, å¦ä¸€ç§ä¸º macro - task.<br>\nå®é™…ä¸Šè¿™ä¸¤ç§ç§°å‘¼å‡ºè‡ªä¸åŒçš„æ ‡å‡†è§„èŒƒ,  taskä¸º <a href=\"https://html.spec.whatwg.org/multipage/webappapis.html#event-loops\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HTML standard</a> ä¸­çš„å«æ³•,<br>\nmacro-task è¿™ç§å«æ³•åº”è¯¥æ˜¯æºè‡ª <a href=\"https://promisesaplus.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Promise/A+</a>.<br>\næˆ‘ä»¬åªè¦çŸ¥é“ä¸¤è€…è¯´çš„å…¶å®éƒ½æ˜¯ä¸€ä¸ªäº‹å°±è¡Œ.<br>\nå¦å¤–, åœ¨ECMAScriptè§„èŒƒä¸­, microtasks ä¹Ÿè¢«ç§°ä¸º jobs.  </p>\n<hr>\n<p><code class=\"language-text\">Tasks</code>:  <strong>setTimeout</strong> ã€<strong>setInterval</strong> ã€ <strong>setImmediate</strong>  ã€requestAnimationFrameã€ I/O ã€UI rendering â€¦  </p>\n<p><code class=\"language-text\">Microtasks</code>:  <strong>process.nextTick</strong> ã€  <strong>Promise</strong> ã€  <strong>MutationObserver</strong> â€¦    </p>\n<p>é¦–å…ˆæ˜ç¡®ä¸€ä¸‹JSçš„æ‰§è¡Œé¡ºåº:  ä¸»çº¿ç¨‹ -> MicroTasks  ->  Tasks;<br>\nçº¿ç¨‹æ‰§è¡Œå®Œæ¯•,  ä¾¿å¼€å§‹æ‰§è¡Œ micro-task , å¹¶æ‰§è¡Œå®Œæ‰€æœ‰å›è°ƒ,  micro-task æ€»æ˜¯å‘ç”Ÿåœ¨ä¸‹ä¸€ä¸ª task ä¹‹å‰.</p>\n<p>é™„æ³¨: </p>\n<ul>\n<li>node11ä¹‹å‰, taskä¸­å¦‚æœæœ‰microtaskçš„, ä¼šå…ˆæ‰§è¡Œå®Œæ‰€æœ‰çš„taskä¹‹å, å†å»æ‰§è¡Œmicrotask</li>\n<li>node11å¼€å§‹,  Event Loopè¿è¡ŒåŸç†å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸€æ—¦æ‰§è¡Œä¸€ä¸ªé˜¶æ®µé‡Œçš„ä¸€ä¸ªå®ä»»åŠ¡(setTimeout,setIntervalå’ŒsetImmediate)å°±ç«‹åˆ»æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œè¿™ç‚¹å°±è·Ÿæµè§ˆå™¨ç«¯ä¸€è‡´äº†ã€‚</li>\n</ul>\n<hr>\n<p>ä¸¾ä¸ªğŸŒ°  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> promise <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve <span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// è¾“å‡º  =>  1 , 2 , 5 , 3 , 4</span></code></pre></div>\n<p>å›æƒ³ä¸€ä¸‹æˆ‘ä»¬ä¸Šé¢æ‰€æåˆ°çš„.  JSçš„æ‰§è¡Œé¡ºåº:  ä¸»çº¿ç¨‹ -> MicroTasks  ->  Tasks  </p>\n<ol>\n<li>\n<p>æ‰€ä»¥é¦–å…ˆæ‰§è¡Œç¬¬ä¸€è¡Œä»£ç , è¾“å‡º <code class=\"language-text\">1</code></p>\n</li>\n<li>\n<p>æ¥ç€, è¿›å…¥ new Promise (å®ƒä¹Ÿæ˜¯åŒæ­¥æ‰§è¡Œçš„ä»£ç ,  thenä¹‹åæ‰æ˜¯å¼‚æ­¥ä»£ç ),  å…ˆè¾“å‡º<code class=\"language-text\">2</code> ; resolve ä¹‹åæŠŠå…¶å›è°ƒå‡½æ•°æ‰”è¿›  <code class=\"language-text\">micro - tasksé˜Ÿåˆ—</code></p>\n</li>\n<li>\n<p>è¿™æ—¶å€™é‡åˆ°ä¸€ä¸ª <code class=\"language-text\">settimeout</code>, ä¸ç®¡å®ƒ, æ‰”äº†(â•¯â€µâ–¡â€²)â•¯ï¸µâ”»â”â”»   (ä¸¢è¿› <code class=\"language-text\">tasks é˜Ÿåˆ—</code>ä¸­)</p>\n</li>\n<li>\n<p>æ‰§è¡Œåˆ°äº†åŒæ­¥ä»£ç çš„æœ€åä¸€è¡Œ, ç›´æ¥è¾“å‡º <code class=\"language-text\">5</code></p>\n</li>\n<li>\n<p>æ­¤æ—¶ä¸»çº¿ç¨‹çš„åŒæ­¥ä»£ç å·²ç»è·‘å®Œ. å¯ä»¥å¼€å§‹æ‰§è¡Œæˆ‘ä»¬çš„å¼‚æ­¥é˜Ÿåˆ—ä¸­çš„äº‹ä»¶</p>\n</li>\n<li>\n<p>å…ˆçœ‹<code class=\"language-text\">micro-tasks</code>,  å‘ç°æœ‰ä¸ªpromiseå›è°ƒå‡½æ•°, è¾“å‡º<code class=\"language-text\">3</code></p>\n</li>\n<li>\n<p>æ­¤æ—¶ <code class=\"language-text\">micro-tasks</code> é˜Ÿåˆ—å·²ç»æ¸…ç©º, æ‰§è¡Œ<code class=\"language-text\">tasks</code> é˜Ÿåˆ—çš„äº‹ä»¶. è¾“å‡º <code class=\"language-text\">5</code>  </p>\n</li>\n</ol>\n<hr>\n<p>å†ä¸¾ä¸ªğŸŒ°  </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">async1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async1 start'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">async2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async1 end'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">async2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async2'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script start'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'setTimeout'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">async1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise1'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise2'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script end'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>async / awaitå…¶å®æ˜¯ç”Ÿæˆå™¨çš„è¯­æ³•ç³–, é‡åˆ°çš„æ—¶å€™æŠŠå®ƒè½¬æ¢æˆ Promise çš„å½¢å¼å³å¯.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// await å‰é¢çš„ä»£ç </span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// await åé¢çš„ä»£ç </span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// do something</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>å…¶ä¸­ <code class=\"language-text\">await å‰é¢çš„ä»£ç </code> æ˜¯åŒæ­¥çš„ï¼Œè°ƒç”¨æ­¤å‡½æ•°æ—¶ä¼šç›´æ¥æ‰§è¡Œï¼›è€Œ <code class=\"language-text\">await bar()</code> è¿™å¥å¯ä»¥è¢«è½¬æ¢æˆ <code class=\"language-text\">Promise.resolve(bar())</code>ï¼›<code class=\"language-text\">await åé¢çš„ä»£ç </code> åˆ™ä¼šè¢«æ”¾åˆ° Promise çš„ then() æ–¹æ³•é‡Œã€‚å› æ­¤ä¸Šé¢çš„ä»£ç å¯ä»¥è¢«è½¬æ¢æˆå¦‚ä¸‹å½¢å¼:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// await å‰é¢çš„ä»£ç </span>\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// await åé¢çš„ä»£ç </span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do something...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ç°åœ¨è®©æˆ‘ä»¬<code class=\"language-text\">é‡æ„</code>ä¸€ä¸‹åˆšæ‰ä»£ç . </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">async1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async1 start'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 2</span>\n\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token function\">async2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async1 end'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 6</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">async2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async2'</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">// 3</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script start'</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// 1</span>\n\n<span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'settimeout'</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">// 8</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token function\">async1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise1'</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">// 4</span>\n  <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'promise2'</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">// 7</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script end'</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">// 5</span></code></pre></div>\n<ul>\n<li>\n<p>é¦–å…ˆè¾“å‡º <code class=\"language-text\">script start</code></p>\n</li>\n<li>\n<p>æ¥ç€å°† <code class=\"language-text\">settimeout</code> æ·»åŠ åˆ°tasksé˜Ÿåˆ—ï¼Œæ­¤æ—¶tasksé˜Ÿåˆ—ä¸º <code class=\"language-text\">[&#39;settimeout&#39;]</code></p>\n</li>\n<li>\n<p>ç„¶åæ‰§è¡Œå‡½æ•° <code class=\"language-text\">async1</code>ï¼Œå…ˆæ‰“å°å‡º <code class=\"language-text\">async1 start</code>ï¼Œåˆå› ä¸º <code class=\"language-text\">Promise.resolve(async2())</code> æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥æ‰“å°å‡º <code class=\"language-text\">async2</code>ï¼Œæ¥ç€å°† <code class=\"language-text\">async1 end</code> æ·»åŠ åˆ°<code class=\"language-text\">MicroTasksé˜Ÿåˆ—</code>ï¼Œï¼Œæ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸º <code class=\"language-text\">[&#39;async1 end&#39;]</code></p>\n</li>\n<li>\n<p>æ¥ç€æ‰“å°å‡º <code class=\"language-text\">promise1</code>ï¼Œå°† <code class=\"language-text\">promise2</code> æ·»åŠ åˆ°<code class=\"language-text\">MicroTasksé˜Ÿåˆ—</code>ï¼Œï¼Œæ­¤æ—¶å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸º <code class=\"language-text\">[&#39;async1 end&#39;, promise2]</code></p>\n</li>\n<li>\n<p>æ‰§è¡Œä¸»çº¿ç¨‹çš„æœ€åä¸€å¥åŒæ­¥ä»£ç , æ‰“å°å‡º <code class=\"language-text\">script end</code></p>\n</li>\n<li>\n<p>å› ä¸º<code class=\"language-text\">MicroTasks</code>ä¼˜å…ˆçº§é«˜äº<code class=\"language-text\">Tasks</code>ï¼Œæ‰€ä»¥å…ˆä¾æ¬¡æ‰“å°å‡º <code class=\"language-text\">async1 end</code> å’Œ <code class=\"language-text\">promise2</code></p>\n</li>\n<li>\n<p>æœ€åæ‰“å°å‡ºTask <code class=\"language-text\">settimeout</code></p>\n</li>\n</ul>\n<p>ç„¶åå°±é˜”ä»¥æ„‰å¿«çš„ç©è€å•¦~</p>\n<!-- [end](/thanks watch/) -->","timeToRead":4,"frontmatter":{"title":"The JavaScript Event Loop","date":"October 29, 2019","spoiler":"JSçš„äº‹ä»¶å¾ªç¯ä»¥åŠå¼‚æ­¥é˜Ÿåˆ—"},"fields":{"slug":"/event-loop/","langKey":"en"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/event-loop/","previous":{"fields":{"slug":"/http-upgrade-https/","langKey":"en","directoryName":"http-upgrade-https","maybeAbsoluteLinks":["/thanks watch/"]},"frontmatter":{"title":"è®°ä¸€æ¬¡httpå‡çº§https"}},"next":null,"translations":[],"translatedLinks":[]}}